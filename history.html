<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
    body {
      font-family: 'Sarabun', sans-serif;
      margin: 0; padding: 20px;
      background-color: #f0f4ff;
      color: #222;
    }
    h1 {
      text-align: center;
      color: #3f51b5;
    }
    .tab-buttons {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    .tab-button {
      background-color: #3f51b5;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 700;
    }
    .tab-button.active {
      background-color: #303f9f;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      background: white;
      border-radius: 12px;
      overflow: hidden;
      margin-top: 10px;
    }
    th, td {
      padding: 12px 16px;
      border: 1px solid #ddd;
      text-align: center;
    }
    thead {
      background: linear-gradient(90deg, #3f51b5, #5c6bc0);
      color: white;
    }
    tbody tr:nth-child(odd) {
      background-color: #f9faff;
    }
    tbody tr:hover {
      background-color: #e3e8ff;
    }
    .back-btn {
      background-color: #dcdcdc;
      padding: 8px 16px;
      border-radius: 8px;
      margin-bottom: 15px;
      display: inline-block;
      cursor: pointer;
    }
    #refreshBtn {
      background-color: #3f51b5;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 700;
      margin-bottom: 10px;
    }
    #chartContainer, #goalChartContainer {
      max-width: 600px;
      margin: 30px auto 0 auto;
      background: white;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.12);
    }
    #chartContainer h3, #goalChartContainer h3 {
      text-align: center;
      color: #3f51b5;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>

<h1>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>

<div class="tab-buttons">
  <button class="tab-button active" onclick="switchTab('savingTab', event)">üí∞ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</button>
  <button class="tab-button" onclick="switchTab('interestTab', event)">üìà ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
</div>

<div class="tab-content active" id="savingTab">
  <button id="refreshBtn">üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button>
  <table>
    <thead>
      <tr>
        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
        <th>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</th>
        <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th>
        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th>
        <th>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</th>
        <th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏±‡∏ô)</th>
        <th>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
      </tr>
    </thead>
    <tbody id="historyBody">
      <tr><td colspan="7" id="noData">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
    </tbody>
  </table>

  <div id="chartContainer" style="display:none;">
    <h3>‡∏Å‡∏£‡∏≤‡∏ü‡∏≠‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥ (‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢)</h3>
    <canvas id="summaryChart"></canvas>
  </div>

  <div id="goalChartContainer" style="display:none;">
    <h3>‡∏Å‡∏£‡∏≤‡∏ü‡∏≠‡∏≠‡∏°‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô)</h3>
    <canvas id="goalChart"></canvas>
  </div>
</div>

<div class="tab-content" id="interestTab">
  <div class="back-btn" onclick="switchTab('savingTab')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</div>
  <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</h2>
  <table>
    <thead>
      <tr>
        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
        <th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th>
        <th>‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</th>
        <th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
      </tr>
    </thead>
    <tbody id="historyTable">
      <tr><td colspan="5">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
    </tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const savingGoalURL = "https://sheetdb.io/api/v1/2ki12whohfir8";
  const savingFixedURL = "https://sheetdb.io/api/v1/zei6m6u4uqbgr";
  const interestSheetURL = "https://sheetdb.io/api/v1/a3v9vau6lv6y5";
  const currentUser = localStorage.getItem("username");
  const tbody = document.getElementById("historyBody");
  const chartContainer = document.getElementById("chartContainer");
  const goalChartContainer = document.getElementById("goalChartContainer");
  const refreshBtn = document.getElementById("refreshBtn");
  let chartInstance = null;
  let goalChartInstance = null;

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì step size ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡∏ô y (‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°)
  function calculateStepSize(maxValue) {
    if (maxValue <= 10) return 1;
    if (maxValue <= 100) return 10;
    if (maxValue <= 1000) return 50;
    if (maxValue <= 5000) return 100;
    if (maxValue <= 10000) return 500;
    if (maxValue <= 50000) return 2000;
    return 5000;
  }

  async function loadSavingData() {
    tbody.innerHTML = `<tr><td colspan="7" id="noData">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>`;
    chartContainer.style.display = 'none';
    goalChartContainer.style.display = 'none';

    try {
      const resGoal = await fetch(`${savingGoalURL}?UserID=${currentUser}`);
      const dataGoal = await resGoal.json();

      const resFixed = await fetch(`${savingFixedURL}?UserID=${currentUser}`);
      const dataFixed = await resFixed.json();

      const allData = [...dataGoal, ...dataFixed];

      if (!allData.length) {
        tbody.innerHTML = `<tr><td colspan="7" id="noData">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</td></tr>`;
        return;
      }

      const summary = {};
      allData.forEach(item => {
        const key = item.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó + '|' + item.‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢;
        if (!summary[key]) {
          summary[key] = {
            ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: item.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó,
            ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: item.‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢,
            ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: 0,
            ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: Number(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î']) || Number(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£']) || Number(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£']) || 0,
            ‡∏¢‡∏≠‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô: Number(item['‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô']) || 0,
            ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: item['‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö'] || item['‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'] || '-',
            ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: item.Date || '-'
          };
        }
        const amount = Number(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£']) || Number(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ']) || 0;
        summary[key].‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° += amount;

        if (item.Date && item.Date > summary[key].‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î) {
          summary[key].‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î = item.Date;
        }
      });

      tbody.innerHTML = "";
      Object.values(summary).forEach(row => {
        const isGoalBased = row.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó.includes("‡∏≠‡∏≠‡∏°‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢");
        const isFixed = row.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó.includes("‡∏≠‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥");

        const ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° = isGoalBased ? "-" : (row.‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ? row.‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°.toLocaleString() : "-");
        const ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î = isFixed ? "-" : (row.‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ? row.‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î.toLocaleString() : "-");
        const ‡∏¢‡∏≠‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô = isFixed ? "-" : (row.‡∏¢‡∏≠‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô ? row.‡∏¢‡∏≠‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô.toLocaleString() : "-");
        const ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î = row.‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î || "-";

        tbody.innerHTML += `
          <tr>
            <td>${row.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó}</td>
            <td>${row.‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢}</td>
            <td>${‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°}</td>
            <td>${‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î}</td>
            <td>${‡∏¢‡∏≠‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô}</td>
            <td>${row.‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤}</td>
            <td>${‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î}</td>
          </tr>
        `;
      });

      showChart(Object.values(summary));
    } catch (error) {
      tbody.innerHTML = `<tr><td colspan="7" id="noData">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
      console.error(error);
    }
  }

  function showChart(data) {
    chartContainer.style.display = 'block';
    goalChartContainer.style.display = 'block';

    const fixed = data.filter(d => d.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó.includes("‡∏≠‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥"));
    const goal = data.filter(d => d.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó.includes("‡∏≠‡∏≠‡∏°‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢"));

    // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥
    const fixedLabels = fixed.map(d => d.‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢);
    const fixedAmounts = fixed.map(d => d.‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°);
    const maxFixed = Math.max(...fixedAmounts, 0);
    const fixedStep = calculateStepSize(maxFixed);

    if (chartInstance) chartInstance.destroy();
    const ctx = document.getElementById('summaryChart').getContext('2d');
    chartInstance = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: fixedLabels,
        datasets: [{
          label: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)',
          data: fixedAmounts,
          backgroundColor: '#3f51b5',
          borderRadius: 6,
          barPercentage: 0.6,
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: {
              display: true,
              text: '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢',
              font: { size: 14, weight: 'bold' }
            }
          },
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)',
              font: { size: 14, weight: 'bold' }
            },
            ticks: {
              stepSize: fixedStep
            }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: ctx => ctx.parsed.y.toLocaleString() + " ‡∏ö‡∏≤‡∏ó"
            }
          }
        }
      }
    });

    // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÉ‡∏ä‡πâ‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô)
    // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÉ‡∏ä‡πâ "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")
const goalLabels = goal.map(d => d.‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢);
const goalAmounts = goal.map(d => d.‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î);
const maxGoal = Math.max(...goalAmounts, 0);
const goalStep = calculateStepSize(maxGoal);

if (goalChartInstance) goalChartInstance.destroy();
const ctx2 = document.getElementById('goalChart').getContext('2d');
goalChartInstance = new Chart(ctx2, {
  type: 'bar',
  data: {
    labels: goalLabels,
    datasets: [{
      label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)',
      data: goalAmounts,
      backgroundColor: '#64b5f6',
      borderRadius: 6,
      barPercentage: 0.6,
    }]
  },
  options: {
    responsive: true,
    scales: {
      x: {
        title: {
          display: true,
          text: '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢',
          font: { size: 14, weight: 'bold' }
        }
      },
      y: {
        beginAtZero: true,
        title: {
          display: true,
          text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)',
          font: { size: 14, weight: 'bold' }
        },
        ticks: {
          stepSize: goalStep
        }
      }
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: ctx => ctx.parsed.y.toLocaleString() + " ‡∏ö‡∏≤‡∏ó"
        }
      }
    }
  }
});

  }

  async function loadInterestHistory() {
    const table = document.getElementById("historyTable");
    table.innerHTML = `<tr><td colspan="5">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>`;
    try {
      const res = await fetch(interestSheetURL);
      const data = await res.json();
      const filtered = data.filter(row => row.UserID === currentUser);
      if (!filtered.length) {
        table.innerHTML = `<tr><td colspan="5">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
        return;
      }
      table.innerHTML = "";
      filtered.reverse().forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å"] || "-"}</td>
          <td>${row["‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£"] || "-"}</td>
          <td>${row["‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢"] || "-"}</td>
          <td>${row["‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö"] || "-"}</td>
          <td>${row["Date"] || "-"}</td>
        `;
        table.appendChild(tr);
      });
    } catch (err) {
      console.error(err);
      table.innerHTML = `<tr><td colspan="5">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
    }
  }

  function switchTab(id, event) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    if(event) event.currentTarget.classList.add('active');
    document.getElementById(id).classList.add('active');

    if(id === 'savingTab') {
      loadSavingData();
    } else if(id === 'interestTab') {
      loadInterestHistory();
    }
  }

  refreshBtn.addEventListener('click', () => {
    loadSavingData();
  });

  loadSavingData();
</script>
</body>
</html>
